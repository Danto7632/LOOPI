name: Simple Deploy

on:
  push:
    branches: [ main ]

permissions:
  contents: read
  pages: write
  id-token: write
  actions: read

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    # ë°±ì—”ë“œ ë¹Œë“œ
    - name: Build Backend
      run: |
        cd backend
        npm ci
        npm run build
        echo "âœ… Backend build completed"

    # í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ
    - name: Build Frontend
      run: |
        cd frontend
        npm ci
        npm run build
        echo "âœ… Frontend build completed"

    # Pages ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ
    - name: Setup Pages
      uses: actions/configure-pages@v4

    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: './frontend/build'

    # GitHub Pages ë°°í¬
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4

    # ë°°í¬ ì™„ë£Œ ì•Œë¦¼
    - name: Deployment Summary
      run: |
        echo "ğŸ‰ ë¹Œë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
        echo ""
        echo "ğŸ“¦ ë¹Œë“œëœ í•­ëª©:"
        echo "  - ë°±ì—”ë“œ: backend/dist/"
        echo "  - í”„ë¡ íŠ¸ì—”ë“œ: frontend/build/"
        echo ""
        echo "ğŸš€ ë‹¤ìŒ ë‹¨ê³„:"
        echo "  1. GitHub Pagesì—ì„œ í”„ë¡ íŠ¸ì—”ë“œ í™•ì¸"
        echo "  2. ë°±ì—”ë“œëŠ” ì›í•˜ëŠ” í˜¸ìŠ¤íŒ… ì„œë¹„ìŠ¤ì— ìˆ˜ë™ ë°°í¬"
        echo "  3. ë˜ëŠ” Vercel/Railway í† í° ì„¤ì • í›„ ìë™ ë°°í¬ í™œì„±í™”"