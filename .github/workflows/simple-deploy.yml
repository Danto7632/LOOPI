name: Simple Deploy

on:
  push:
    branches: [ main ]

permissions:
  contents: read
  pages: write
  id-token: write
  actions: read

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    # 백엔드 빌드
    - name: Build Backend
      run: |
        cd backend
        npm ci
        npm run build
        echo "✅ Backend build completed"

    # 프론트엔드 빌드
    - name: Build Frontend
      run: |
        cd frontend
        npm ci
        npm run build
        echo "✅ Frontend build completed"

    # Pages 아티팩트 업로드
    - name: Setup Pages
      uses: actions/configure-pages@v4

    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: './frontend/build'

    # GitHub Pages 배포
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4

    # 배포 완료 알림
    - name: Deployment Summary
      run: |
        echo "🎉 빌드가 성공적으로 완료되었습니다!"
        echo ""
        echo "📦 빌드된 항목:"
        echo "  - 백엔드: backend/dist/"
        echo "  - 프론트엔드: frontend/build/"
        echo ""
        echo "🚀 다음 단계:"
        echo "  1. GitHub Pages에서 프론트엔드 확인"
        echo "  2. 백엔드는 원하는 호스팅 서비스에 수동 배포"
        echo "  3. 또는 Vercel/Railway 토큰 설정 후 자동 배포 활성화"